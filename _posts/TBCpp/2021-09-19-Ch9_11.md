---
title: "C++ Chapter9_11 ëŒ€ì… ì—°ì‚°ì ì˜¤ë²„ë¡œë”©, ê¹Šì€ ë³µì‚¬ Deep copy vs ì–•ì€ ë³µì‚¬ shallow copy" 
excerpt: "ëŒ€ì… ì—°ì‚°ì ì˜¤ë²„ë¡œë”©, ê¹Šì€ ë³µì‚¬ Deep copy vs ì–•ì€ ë³µì‚¬ shallow copy"
categories:
  - Cpp
tags:
  - Cpp
last_modified_at: 2021-09-19
toc: true
toc_sticky: true
toc_label: "ëª©ì°¨ğŸ‘€"
---

<pre>ë³¸ í•„ê¸°ëŠ” ì¸í”„ëŸ°ì˜ í™ì •ëª¨ êµìˆ˜ë‹˜ì˜ ê°•ì˜ì¸ <b>í™ì •ëª¨ì˜ ë”°ë¼í•˜ë©° ë°°ìš°ëŠ” C++</b> ë¥¼ ë“£ê³  ì‘ì„±í•©ë‹ˆë‹¤.</pre>{: .notice--success}

### [ëŒ€ì… ì—°ì‚°ì ì˜¤ë²„ë¡œë”©, ê¹Šì€ ë³µì‚¬ Deep copy vs ì–•ì€ ë³µì‚¬ shallow copy]
```cpp
class MyString
{
public:
    char *m_data = nullptr;
    int m_length = 0;
	
    //std::string data;	
						
public:
    MyString(const char *source = "") 
    {
        assert(source);

        m_length = std::strlen(source) + 1;     // null character ê°€ ë“¤ì–´ê°ˆ ê³µê°„ ì¶”ê°€
        m_data = new char[m_length];

        for (int i = 0; i < m_length; ++i)
            m_data[i] = source[i];

        m_data[m_length - 1] = '\0';
    }

    MyString(const MyString &source)             // ì‚¬ìš©ì ì •ì˜ copy constructor
    {
        cout << "Copy constructor " << endl;

        m_length = source.m_length;

        if (source.m_data != nullptr)           // ë©”ëª¨ë¦¬ë¥¼ ìƒˆë¡œ í• ë‹¹ë°›ê³  ê°’ë“¤ì„ ë‹¤ì‹œ ë³µì‚¬í•œë‹¤.
        {
            m_data = new char[m_length];        // Deep copy

            for (int i = 0; i < m_length; ++i)
                m_data[i] = source.m_data[i];
        }
        else
            m_data = nullptr;
    }
    
    MyString& operator = (const MyString &source) // ì‚¬ìš©ì ì •ì˜ assignment operator
    {
        cout << "Assignment operator " << endl;

        if (this == &source)	
            return *this;

        delete[] m_data;		

        // ìœ„ì˜ copy constructor ì™€ ë™ì¼í•œ ë‚´ìš©ì˜ ì—°ì†. ì‹¤ì œë¡œëŠ” ë™ì¼í•œ ë¶€ë¶„ì€ í•¨ìˆ˜ë¡œ ë¶„ë¦¬í•´ì„œ ì‚¬ìš©í•˜ì.
        m_length = source.m_length;	

        if (source.m_data != nullptr)
        {
            m_data = new char[m_length];

            for (int i = 0; i < m_length; ++i)
            m_data[i] = source.m_data[i];
        }
        else
            m_data = nullptr;

        return *this;
    }

    ~MyString()
    {
        delete[] m_data;
    }

    char* getString() { return m_data; }
    int getLength() { return m_length; }
};
```
* copy constructor ì™€ assignment operator ì˜ ì°¨ì´
    * copy constructor ëŠ” ê¸°ì¡´ì˜ ê°ì²´ë¥¼ ë³µì‚¬í•˜ì—¬ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
    * assignment operator ëŠ” ê¸°ì¡´ì— ì¡´ì¬í•˜ë˜ ë‘ ê°ì²´ ì‚¬ì´ì˜ ëŒ€ì…ì´ë‹¤.
* `MyString& operator = (const MyString &source) {~}`
    * `if (this == &source) { return *this; }`	prevent self-assignment
        * self-assignment ëŠ” í”„ë¡œê·¸ë¨ ì…ì¥ì—ì„œëŠ” ë¬¸ì œê°€ ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ assignment operator ì˜¤ë²„ë¡œë”© í•¨ìˆ˜ì—ì„œ ë°©ì§€í•˜ì. 
    * `delete[] m_data;` ë³¸ë˜ì˜ í¬ì¸í„° ê°’ì„ delete í•´ì¤€ë‹¤. delete í•˜ì§€ ì•Šê³  ë°”ë¡œ ëŒ€ì…í•˜ê²Œ ë˜ë©´ memory leak ì´ ë°œìƒí•œë‹¤.
    * `return *this;` ìì‹ ì˜ ì£¼ì†Œë¥¼ ë°˜í™˜í•´ì„œ Multiple assignment ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.
        * `a = b = c` a ì™€ b ëª¨ë‘ c ì™€ ê°™ì€ ê°’ì´ ëŒ€ì…ëœë‹¤.
* ë™ì í• ë‹¹ëœ í¬ì¸í„°ì˜ ë©”ëª¨ë¦¬ëŠ” í™ì— ë“¤ì–´ìˆëŠ”ë° í•´ë‹¹ ë©”ëª¨ë¦¬ë¥¼ ì‚­ì œí•´ë„ í¬ì¸í„°ëŠ” ì‚­ì œëœ ë©”ëª¨ë¦¬ì— ê°€ì„œ ê±°ê¸°ì— ë“¤ì–´ìˆëŠ” ê°’ì„ êµ¬í•´ì˜¤ë ¤ê³  í•˜ê¸° ë•Œë¬¸ì— ì£¼ì˜ê°€ í•„ìš”í•˜ë‹¤.
    * ì¦‰, í¬ì¸í„°ì—ì„œ ë©”ëª¨ë¦¬ë¡œ ê°€ëŠ” ê¸¸ì´ ìˆëŠ”ë° ë©”ëª¨ë¦¬ê°€ ì‚­ì œë˜ë„ í¬ì¸í„°ì—ì„œ ë©”ëª¨ë¦¬ë¡œ ê°€ëŠ” ê¸¸ì€ ë‚¨ì•„ìˆê²Œ ë˜ë¯€ë¡œ í¬ì¸í„°ê°€ ë©”ëª¨ë¦¬ë¡œ ì ‘ê·¼í•˜ë©´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
    * ë”°ë¼ì„œ delete í›„ì—” í¬ì¸í„°ë¥¼ nullptr ë¡œ ë§Œë“¤ì.

<pre>info notice :
í•´ë‹¹ ì˜ˆì œì—ì„œëŠ” char* m_data ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° std::string data; ì™€ ê°™ì´ ê¹”ë”í•˜ê²Œ êµ¬í˜„ëœ std::string ì„ ì‚¬ìš©í•˜ë©´ í¸í•˜ë‹¤. 
í˜¹ì€ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ë©´ std::string ì„ ìƒì†í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•´ ê¸°ëŠ¥ì„ ì¶”ê°€í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</pre>{: .notice--warning}

#### ì‚¬ìš© ì˜ˆ
```cpp
MyString hello("Hello");

//MyString str1 = hello;    // copy constructor
MyString str1(hello);	    
cout << hello.getString() << endl;

MyString str2;
str2 = hello;               // assignment operator
cout << str2.getString() << endl;

//hello = hello;	

// ì¶œë ¥
Copy constructor
Hello
Assignment operator
Hello
```
* `MyString str1 = hello;` , `MyString str1(hello);` ë‘ í‘œí˜„ì€ ë™ì¼í•˜ë‹¤.
    * `MyString str1 = hello;` ì€ ëŒ€ì… ì—°ì‚°ìì™€ í—·ê°ˆë¦´ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¢€ ë” ëª…í™•í•˜ê²Œ `MyString str1(hello);` ë¡œ í‘œí˜„í•˜ì.
* `hello = hello;` í”„ë¡œê·¸ë¨ ì…ì¥ì—ì„œëŠ” ë¬¸ì œê°€ ë ìˆ˜ ìˆìœ¼ë¯€ë¡œ assignment operator ì˜¤ë²„ë¡œë”© í•¨ìˆ˜ì—ì„œ ë°©ì§€í•˜ì.
* assignment operator ê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

___
<br>

#### shallow copy
```cpp
// default copy constructor & default assignment operator
this->m_data = source.m_data;
this->m_length = source.m_length;
```
* default copy constructor ì™€ default assignment operator ëŠ” ìœ„ì™€ ê°™ì´ shallow copy ë¥¼ í•œë‹¤.

```cpp
MyString hello("Hello");
cout << (int*)hello.m_data << endl;   // í¬ì¸í„°ê°€ ê°€ì§€ëŠ” ì£¼ì†Œ ì¶œë ¥
cout << hello.getString() << endl;

{
    MyString copy = hello;              // default copy constructor ê°€ í˜¸ì¶œëœë‹¤ê³  ê°€ì •.
    cout << (int*)copy.m_data << endl;
    cout << copy.getString() << endl;
}

cout << hello.getString() << endl;    // runtime-error 

// ì¶œë ¥
0087E170
Hello
0087E170
Hello
ç¡¼ç¡¼ç¡¼ç¡¼ç¡¼ç¡¼ç¡¼ç¡¼?ë¤¯ // garbage value
```
* default copy constructor ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ shallow copy ë¥¼ í•˜ê¸° ë•Œë¬¸ì— í¬ì¸í„° hello.m_data ì™€ copy.m_data ëŠ” ê°™ì€ ì£¼ì†Œë¥¼ ê°€ë¥´í‚¨ë‹¤.
  * { ~ } ë¸”ëŸ­ ì•ˆì—ì„œ ë³µì‚¬ëœ copy ê°€ ë¸”ëŸ­ì´ ì¢…ë£Œë˜ë©´ì„œ ì†Œë©¸ìê°€ í˜¸ì¶œë˜ì–´ copy.m_data ê°€ delete ëœë‹¤.
  * ê²°êµ­ hello.m_data ê°€ ê°€ë¥´í‚¤ëŠ” ì£¼ì†Œ ë˜í•œ ì‚¬ë¼ì§€ëŠ” ê²°ê³¼ë¥¼ ë‚³ê²Œ ë˜ë¯€ë¡œ { ~ } ì„ ë¹ ì ¸ë‚˜ì˜¨ í›„ ìˆ˜í–‰ë˜ëŠ” `cout << hello.getString() << endl;` ì—ì„œ runtime-error ê°€ ë°œìƒí•œë‹¤.

#### deep copy
```cpp
MyString hello("Hello");
cout << (int*)hello.m_data << endl;   // í¬ì¸í„°ê°€ ê°€ì§€ëŠ” ì£¼ì†Œ ì¶œë ¥
cout << hello.getString() << endl;

{
    MyString copy = hello;              // MyString ë‚´ë¶€ì—ì„œ ì‚¬ìš©ì ì •ì˜í•œ copy constructor
    cout << (int*)copy.m_data << endl;
    cout << copy.getString() << endl;
}

cout << hello.getString() << endl;	

// ì¶œë ¥
007DF408
Hello
Copy constructor
007DF590
Hello
Hello
```
* copy constructor ì—ì„œ deep copy ë¥¼ ìˆ˜í–‰í•˜ê¸° ë•Œë¬¸ì— hello.m_data ì™€ ë‹¤ë¥¸ ì£¼ì†Œë¥¼ ê°€ë¥´í‚¤ë©´ì„œ ë™ì¼í•œ ê°’ì„ ê°€ì§€ëŠ” copy.m_data ë¥¼ ìƒˆë¡­ê²Œ ë™ì í• ë‹¹í•œë‹¤.
    * ì¦‰, hello.m_data ì™€ copy.m_data ê°€ ê°€ë¥´í‚¤ëŠ” ì£¼ì†ŒëŠ” ë‹¤ë¥¸ ì£¼ì†Œì´ë‹¤.
    * ë”°ë¼ì„œ { ~ } ë¥¼ ë¹ ì ¸ë‚˜ì™€ë„ copy.m_data ê°€ ê°€ë¥´í‚¤ëŠ” ë©”ëª¨ë¦¬ë§Œ ì‚¬ë¼ì§€ê³  `cout << hello.getString() << endl;	` ì—ì„œ ì—¬ì „íˆ hello.m_data ì˜ ê°’ì„ ì¶œë ¥í•  ìˆ˜ ìˆë‹¤.

___
<br>

#### ì°¸ê³ 
* ë™ì í• ë‹¹ëœ ë©”ëª¨ë¦¬ì— ëŒ€í•œ í¬ì¸í„° ë³€ìˆ˜ë¥¼ ë©¤ë²„ë¡œì„œ ê°€ì§€ê³  ìˆëŠ” í´ë˜ìŠ¤ëŠ” ë³µì‚¬ë¥¼ í•  ë•Œ 
ê¹Šì€ ë³µì‚¬ëƒ ì–•ì€ ë³µì‚¬ëƒì— ë”°ë¼ì„œ copy constructor or assignment operator êµ¬í˜„ì´ ê¹Œë‹¤ë¡œì›Œì§„ë‹¤.
* ë³µì‚¬ ìƒì„±ìë¥¼ ê¹”ë”í•˜ê²Œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ê°€ì¥ ì¢‹ì§€ë§Œ ê·¸ë ‡ì§€ ëª»í•  ê²½ìš°ì—ëŠ”, í˜¹ì€ ë‚´ê°€ êµ¬í˜„í•œ copy constructor  or assignment operator ë¥¼ ì“°ì§€ ëª»í•  ë°”ì—ëŠ” shallow copy ë¥¼ ë§‰ê¸°ìœ„í•´ ì°¨ì„ ì±…ìœ¼ë¡œ ì•„ì˜ˆ copy constructor  or assignment operator ë¥¼ ì“°ì§€ ëª»í•˜ë„ë¡ delete ë¡œ ë§‰ê±°ë‚˜ private ìœ¼ë¡œ ì˜®ê¸°ëŠ” ë°©ë²•ì´ ìˆë‹¤.  
    * ìµœì„ ì±…ì€ ê¹”ë”í•˜ê²Œ êµ¬í˜„ëœ copy constructor or assignment operator ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ë‹¤.

<pre>ë³¸ ë¸”ë¡œê·¸ëŠ” ê°œì¸ ê³µë¶€ ê¸°ë¡ì˜ ëª©ì ì„ ê°€ì§‘ë‹ˆë‹¤. í¬ìŠ¤íŠ¸ì˜ ë‚´ìš©ì€ ì–¸ì œë“ ì§€ ë°”ë€” ìˆ˜ ìˆìŠµë‹ˆë‹¤.</pre>{: .notice--info}