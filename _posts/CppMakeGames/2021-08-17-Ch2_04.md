---
title: "C++ Games Chapter2_4 ë‹¤í˜•ì„±ê³¼ ê³µì¥ íŒ¨í„´ Factory Pattern"
excerpt: "ë‹¤í˜•ì„±ê³¼ ê³µì¥ íŒ¨í„´ Factory Pattern"
categories:
  - Cpp MakeGames
tags:
  - Cpp
last_modified_at: 2021-08-17
toc: true
toc_sticky: true
toc_label: "ëª©ì°¨ğŸ‘€"
---

<pre>ë³¸ í•„ê¸°ëŠ” ì¸í”„ëŸ°ì˜ í™ì •ëª¨ êµìˆ˜ë‹˜ì˜ ê°•ì˜ì¸ <b>í™ì •ëª¨ì˜ ê²Œì„ ë§Œë“¤ê¸° ì—°ìŠµ ë¬¸ì œ íŒ¨í‚¤ì§€</b> ë¥¼ ë“£ê³  ì‘ì„±í•©ë‹ˆë‹¤.</pre>{: .notice--success}

### ë‹¤í˜•ì„±ê³¼ ê³µì¥ íŒ¨í„´ Factory Pattern
**ê¸°ì¡´ ì½”ë“œ**
```cpp
#include "Game2D.h"
#include "Examples/PrimitivesGallery.h"
#include "RandomNumberGenerator.h"
#include <vector>
#include <memory>

#include "Triangle.h"
#include "Circle.h"
#include "Box.h"

namespace jm
{
    class Example : public Game2D
    {
    public:
        std::vector<GeometricObject *> my_objs;

        Example()
            : Game2D()
        {
            my_objs.push_back(new Triangle(Colors::gold, vec2{ -0.5f, 0.2f }, 0.25f));
            my_objs.push_back(new Circle(Colors::olive, vec2{ 0.1f, 0.1f }, 0.2f));
            my_objs.push_back(new Box(Colors::blue, vec2{ 0.0f, 0.5f }, 0.15f, 0.25f));
        }

        ~Example()
        {
            // delete is unnecessary with shared_ptr
            for (const auto & obj : my_objs)
                delete obj;
        }

        void update() override
        {
            for (const auto & obj : my_objs)
                obj->draw();
        }
    };
}
...
```
ê¸°ì¡´ì˜ ì½”ë“œì—ì„œëŠ” ìƒˆë¡œìš´ ì˜¤ë¸Œì íŠ¸ê°€ ì¶”ê°€ë  ë•Œ ë§ˆë‹¤ í•´ë‹¹ ì˜¤ë¸Œì íŠ¸ì˜ í´ë˜ìŠ¤ê°€ ì •ì˜ë˜ì–´ìˆëŠ” í—¤ë”íŒŒì¼ì„ include í•´ì•¼í•œë‹¤.    

ê³µì¥ íŒ¨í„´ì„ ì´ìš©í•´ ì´ë¥¼ í•´ê²°í•˜ê³  ì½”ë“œë¥¼ ë”ìš± ê°„ê²°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ì˜¤ë¸Œì íŠ¸ë¥¼ my_objs ì— ë„£ì„ ë•Œ ë¶€ëª¨ í´ë˜ìŠ¤ GeometricObject ì˜ í¬ì¸í„°ë¡œ ë„£ê¸° ë•Œë¬¸ì— í•´ë‹¹ ì½”ë“œì—ì„œëŠ” Triangle, Circle, Box ë“± ìì‹ í´ë˜ìŠ¤ì— ëŒ€í•´ì„œ ì•Œ í•„ìš”ê°€ ì—†ë‹¤.    
ë”°ë¼ì„œ ë¶€ëª¨ í´ë˜ìŠ¤ GeometricObject ë§Œì„ ì•„ëŠ” ìƒíƒœë¡œ ì½”ë“œë¥¼ ë³€ê²½í•  ê²ƒì´ë‹¤.

```cpp
// in GeometricObject.h
#pragma once

#include "Game2D.h"

#include "Triangle.h"
#include "Circle.h"
#include "Box.h"

namespace jm
{
    class GeometricObject
    {
    public:
        ...
            
        static GeometricObject * makeTriangle(const RGB & _color, const vec2 & _pos, const float & _size)
        {
            return new Triangle(_color, _pos, _size);
        }

        static GeometricObject * makeCircle(const RGB & _color, const vec2 & _pos, const float & _size)
        {
            return new Circle(_color, _pos, _size);
        }

        static GeometricObject * makeBox(const RGB & _color, const vec2 & _pos, const float & _width,
            const float & _height)
        {
            return new Box(_color, _pos, _width, _height);
        }
    };
}
```
ìì‹ í´ë˜ìŠ¤ë“¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ì—¬ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë¥¼ static í•¨ìˆ˜ë¡œ ë§Œë“¤ì–´ì„œ ë¶€ëª¨ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ê°€ ì—†ë”ë¼ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.    
ì´ë•Œ ê°ê°ì˜ Triangle.h, Circle.h, Box.h ì—ì„œë„ í—¤ë‹¹ í•´ë”íŒŒì¼ GeometricObject.h ë¥¼ include í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë‘ íŒŒì¼ê°„ì˜ ëŒê³ ë„ëŠ” ì¤‘ë³µì´ ë°œìƒí•œë‹¤.    
ë”°ë¼ì„œ ì´ë ‡ê²Œ ì‚¬ìš©í•˜ì§€ ë§ê³  ì†ŒìŠ¤íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ìì‹ í´ë˜ìŠ¤ì˜ í—¤ë”íŒŒì¼ë“¤ì˜  include ì™€ ê·¸ê²ƒì´ í•„ìš”í•œ ì•„ë˜ì˜ makeTriangle, makeCircle, makeBox í•¨ìˆ˜ë¥¼ ì†ŒìŠ¤íŒŒì¼ë¡œ ì˜®ê¸´ë‹¤.  

```cpp
// in GeometricObject.h
#pragma once

#include "Game2D.h"

namespace jm
{
    class GeometricObject
    {
    public:
        ...
            
        static GeometricObject * makeTriangle(const RGB & _color, const vec2 & _pos, const float & _size);

        static GeometricObject * makeCircle(const RGB & _color, const vec2 & _pos, const float & _size);

        static GeometricObject * makeBox(const RGB & _color, const vec2 & _pos, const float & _width,
            const float & _height);
    };
}

// in GeometricObject.cpp
#include "GeometricObject.h"

#include "Triangle.h"
#include "Circle.h"
#include "Box.h"

namespace jm
{
    GeometricObject * GeometricObject::makeTriangle(const RGB & _color, const vec2 & _pos, const float & _size)
    {
        return new Triangle(_color, _pos, _size);
    }

    GeometricObject * GeometricObject::makeCircle(const RGB & _color, const vec2 & _pos, const float & _size)
    {
        return new Circle(_color, _pos, _size);
    }

    GeometricObject * GeometricObject::makeBox(const RGB & _color, const vec2 & _pos, 
        const float & _width, const float & _height)
    {
        return new Box(_color, _pos, _width, _height);
    }
}

// in main.cpp
...

//#include "Triangle.h"
//#include "Circle.h"
//#include "Box.h"
#include "GeometricObject.h"

namespace jm
{
    class Example : public Game2D
    {
    public:
        std::vector<GeometricObject *> my_objs;

        Example()
            : Game2D()
        {
            my_objs.push_back(GeometricObject::makeTriangle(Colors::gold, vec2{ -0.5f, 0.2f }, 0.25f));
            my_objs.push_back(GeometricObject::makeCircle(Colors::olive, vec2{ 0.1f, 0.1f }, 0.2f));
            my_objs.push_back(GeometricObject::makeBox(Colors::blue, vec2{ 0.0f, 0.5f }, 0.15f, 0.25f));
        }
        ...
    };
}
...
```
ë¶€ëª¨ í´ë˜ìŠ¤ GeometricObject.h ë§Œ include í•˜ì—¬ ìì‹ í´ë˜ìŠ¤ì— ëŒ€í•´ ëª¨ë¥´ëŠ” ìƒíƒœë¡œ `include í•˜ì§€ ì•Šì€ ì±„ë¡œ` GeometricObject í´ë˜ìŠ¤ì˜ static í•¨ìˆ˜ë¡œ GeometricObject ì˜ ì¸ìŠ¤í„´ìŠ¤ ì—†ì´ ìì‹ í´ë˜ìŠ¤ì˜ ê°ì²´ë¥¼ push_back í•  ìˆ˜ ìˆë‹¤.

### ìƒˆë¡œìš´ ì˜¤ë¸Œì íŠ¸ Star ì¶”ê°€í•˜ê¸°
```cpp
// in Star.h
#pragma once

#include "GeometricObject.h"

namespace jm
{
    class Star : public GeometricObject
    {
    public:
        float outer_radius, inner_radius;

        Star(const RGB & _color, const vec2 & _pos, const float & _outer,
            const float & _inner)
        {
            init(_color, _pos, _outer, _inner);
        }

        void init(const RGB & _color, const vec2 & _pos, const float & _outer,
            const float & _inner)
        {
            GeometricObject::init(_color, _pos);

            outer_radius = _outer;
            inner_radius = _inner;
        }

        void drawGeometry() const override
        {
            drawFilledStar(GeometricObject::color, outer_radius, inner_radius);
        }
    };
}

// in GeometricObject.h
#pragma once

#include "Game2D.h"

namespace jm
{
    class GeometricObject
    {
    public:
        ...
        static GeometricObject * makeStar(const RGB & _color, const vec2 & _pos, const float & _outer,
			const float & _inner);
    };
}

// in GeometricObject.cpp
#include "GeometricObject.h"

...
#include "Star.h"

namespace jm
{
    ...
    GeometricObject * GeometricObject::makeStar(const RGB & _color, const vec2 & _pos, const float & _outer, const float & _inner)
	{
		return new Star(_color, _pos, _outer, _inner);
	}
}

// in main.cpp
...
#include "GeometricObject.h"

namespace jm
{
    class Example : public Game2D
    {
    public:
        std::vector<GeometricObject *> my_objs;

        Example()
            : Game2D()
        {
            ...
            my_objs.push_back(GeometricObject::makeStar(Colors::gold, vec2{ 0.0f, -0.5f, }, 0.25f, 0.15f));
        }
        ...
    };
}
...
```
ë‹¤í˜•ì„±ê³¼ ê³µì¥ íŒ¨í„´ì„ ì´ìš©í•˜ë©´ update() í•¨ìˆ˜ë¥¼ ê±´ë“œë¦¬ì§€ ì•Šê³  main.cpp ì™€ GeometricObject.h ì—ì„œ star.h ë¥¼ include í•˜ì§€ ì•Šê³  GeometricObject.cpp ì—ì„œë§Œ star.h ë¥¼ include í•˜ê³  makeStar í•¨ìˆ˜ë§Œ ì¶”ê°€í•˜ë©´ ê°„ê²°í•˜ê³  ì‰½ê²Œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì¶”ê°€ë¡œ ê·¸ë¦´ ìˆ˜ ìˆë‹¤.

### ì¶”ê°€ ì—°ìŠµë¬¸ì œ
ë‹¤í˜•ì„±ê³¼ ê³µì¥ íŒ¨í„´ì„ ì ìš©í•œ ì½”ë“œë¥¼ ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°ë¥¼ ì´ìš©í•˜ë„ë¡ ì½”ë“œë¥¼ ë³€ê²½í–ˆë‹¤.

```cpp
// in GeometricObject.h
#pragma once

#include "Game2D.h"
#include <memory>

namespace jm
{
    class GeometricObject
    {
    public:
        ...

        static std::shared_ptr<GeometricObject> makeTriangle(const RGB & _color, const vec2 & _pos, const float & _size);

        static std::shared_ptr<GeometricObject> makeCircle(const RGB & _color, const vec2 & _pos, const float & _size);

        static std::shared_ptr<GeometricObject> makeBox(const RGB & _color, const vec2 & _pos, const float & _width,
            const float & _height);

        static std::shared_ptr<GeometricObject> makeStar(const RGB & _color, const vec2 & _pos, const float & _outer,
            const float & _inner);
    };
}

// in GeometricObject.cpp
#include "GeometricObject.h"

#include "Triangle.h"
#include "Circle.h"
#include "Box.h"
#include "Star.h"

namespace jm
{
    std::shared_ptr<GeometricObject> GeometricObject::makeTriangle(const RGB & _color, const vec2 & _pos, const float & _size)
    {
        return std::make_shared<Triangle>(_color, _pos, _size);
    }

    std::shared_ptr<GeometricObject> GeometricObject::makeCircle(const RGB & _color, const vec2 & _pos, const float & _size)
    {
        return std::make_shared<Circle>(_color, _pos, _size);
    }

    std::shared_ptr<GeometricObject> GeometricObject::makeBox(const RGB & _color, const vec2 & _pos, const float & _width, const float & _height)
    {
        return std::make_shared<Box>(_color, _pos, _width, _height);
    }

    std::shared_ptr<GeometricObject> GeometricObject::makeStar(const RGB & _color, const vec2 & _pos, const float & _outer, const float & _inner)
    {
        return std::make_shared<Star>(_color, _pos, _outer, _inner);
    }
}

// in main.cpp
#include "Game2D.h"
#include "Examples/PrimitivesGallery.h"
#include "RandomNumberGenerator.h"
#include <vector>

//#include "Triangle.h"
//#include "Circle.h"
//#include "Box.h"
#include "GeometricObject.h"

namespace jm
{
    class Example : public Game2D
    {
    public:
        std::vector<std::shared_ptr<GeometricObject>> my_objs;

        Example()
            : Game2D()
        {
            my_objs.push_back(GeometricObject::makeTriangle(Colors::gold, vec2{ -0.5f, 0.2f }, 0.25f));
            my_objs.push_back(GeometricObject::makeCircle(Colors::olive, vec2{ 0.1f, 0.1f }, 0.2f));
            my_objs.push_back(GeometricObject::makeBox(Colors::blue, vec2{ 0.0f, 0.5f }, 0.15f, 0.25f));
            my_objs.push_back(GeometricObject::makeStar(Colors::gold, vec2{ 0.0f, -0.5f, }, 0.25f, 0.15f));
        }

        ~Example()
        {
            // delete is unnecessary with shared_ptr
            /*for (const auto & obj : my_objs)
                delete obj;*/
        }
        ...
    };
}
...
```
main.cpp ì—ì„œ GeometricObject ì˜ í¬ì¸í„°ë¥¼ ë‹´ëŠ” vector ë¥¼ GeometricObject ì˜ shared_ptr ì„ ë‹´ë„ë¡ ë³€ê²½í•˜ê³  
GeometricObject ì˜ ìì‹ í´ë˜ìŠ¤ë“¤ì˜ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ë°˜í™˜í•´ì£¼ëŠ” make~() í•¨ìˆ˜ì—ì„œ shared_ptr ë¥¼ ë§Œë“¤ì–´ì„œ ë°˜í™˜í•˜ë„ë¡ ë³€ê²½í•œë‹¤.

ë˜í•œ ìŠ¤ë§ˆíŠ¸ í¬ì¸í„°ëŠ” delete í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì— ì†Œë©¸ìì—ì„œ delete í•´ì£¼ëŠ” ë¶€ë¶„ì„ ì œê±°í•œë‹¤.


<pre>ë³¸ ë¸”ë¡œê·¸ëŠ” ê°œì¸ ê³µë¶€ ê¸°ë¡ì˜ ëª©ì ì„ ê°€ì§‘ë‹ˆë‹¤. í¬ìŠ¤íŠ¸ì˜ ë‚´ìš©ì€ ì–¸ì œë“ ì§€ ë°”ë€” ìˆ˜ ìˆìŠµë‹ˆë‹¤.</pre>{: .notice--info}