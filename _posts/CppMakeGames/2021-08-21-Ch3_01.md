---
title: "C++ Games Chapter3_1 ê³µ íŠ•ê¸°ê¸° ì‹œë®¬ë ˆì´ì…˜ Simulation"
excerpt: "ê³µ íŠ•ê¸°ê¸° ì‹œë®¬ë ˆì´ì…˜ Simulation"
categories:
  - Cpp MakeGames
tags:
  - Cpp
last_modified_at: 2021-08-21
toc: true
toc_sticky: true
toc_label: "ëª©ì°¨ğŸ‘€"
---

<pre>ë³¸ í•„ê¸°ëŠ” ì¸í”„ëŸ°ì˜ í™ì •ëª¨ êµìˆ˜ë‹˜ì˜ ê°•ì˜ì¸ <b>í™ì •ëª¨ì˜ ê²Œì„ ë§Œë“¤ê¸° ì—°ìŠµ ë¬¸ì œ íŒ¨í‚¤ì§€</b> ë¥¼ ë“£ê³  ì‘ì„±í•©ë‹ˆë‹¤.</pre>{: .notice--success}

íŠ¹íˆ ì‹¤ì‹œê°„ ê²Œì„ìš© ë¬¼ë¦¬ ì—”ì§„ì„ ë§Œë“¤ ë•Œ ê°€ì¥ ì‰½ê³  ê°„ë‹¨í•˜ê³  ëª¨ë‘ê°€ ì‹œì‘ì ìœ¼ë¡œ ìƒê°í•˜ëŠ” ê³µ íŠ•ê¸°ê¸° ì‹œë®¬ë ˆì´ì…˜ì— ëŒ€í•´ ì„¤ëª…í•œë‹¤.

### ê³µ íŠ•ê¸°ê¸° ì‹œë®¬ë ˆì´ì…˜
**ê¸°ë³¸ ì½”ë“œ**
```cpp
#include "Game2D.h"
#include "Examples/PrimitivesGallery.h"
#include "RandomNumberGenerator.h"
#include <vector>
#include <memory>

namespace jm
{
    class RigidCircle	// Rigid : ë”±ë”±í•œ
    {
    public:
        vec2 pos;
        vec2 vel;
        float radius = 0.1f;

        void draw()
        {
            beginTransformation();
            {
                translate(pos);
                drawFilledCircle(Colors::hotpink, radius - 1e-3f);
                setLineWidth(2.0f);
                drawWiredCircle(Colors::black, radius);
            }
            endTransformation();
        }

        void update(const float & dt)
        {
            // numerical integration ìˆ˜ì¹˜ ì ë¶„

            // wall collision, friction
        }
    };

    class Example : public Game2D
    {
    public:
        RigidCircle rigid_body;

        Example()
            : Game2D()
        {
            reset();
        }

        void reset()
        {
            // Initial position and velocity
            rigid_body.pos = vec2(-0.8f, 0.3f);
            rigid_body.vel = vec2(10.0f, 0.0f);	// 10 m/s
        }

        void drawWall()
        {
            setLineWidth(5.0f);
            drawLine(Colors::blue, { -1.0f, -1.0f }, Colors::blue, { 1.0f, -1.0f });
            drawLine(Colors::blue, { 1.0f, -1.0f }, Colors::blue, { 1.0f, 1.0f });
            drawLine(Colors::blue, { -1.0f, -1.0f }, Colors::blue, { -1.0f, 1.0f });
        }

        void update() override
        {
            // physics update
            rigid_body.update(getTimeStep() * 0.1f);

            // draw
            drawWall();
            rigid_body.draw();

            // reset button
            if (isKeyPressedAndReleased(GLFW_KEY_R)) reset();
        }
    };
}

int main(void)
{
    jm::Example().run();

    return 0;
}
```
RigidCircle í´ë˜ìŠ¤ì˜ update í•¨ìˆ˜ë¥¼ ë³€ê²½ì‹œì¼œì„œ ê³µì„ ì›€ì§ì¸ë‹¤.

Example í´ë˜ìŠ¤ì˜ update í•¨ìˆ˜ì—ì„œ rigid_body ì˜ update í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ë•Œ getTimeStep ì˜ ë°˜í™˜ ê°’ì— 0.1f ë¥¼ ê³±í•˜ëŠ” ì´ìœ ëŠ” ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒì†ë„ë¥¼ 0.1 ë°°ë¡œ ì¤„ì¸ ê²ƒì´ë‹¤.

#### numerical integration ìˆ˜ì¹˜ ì ë¶„ì„ í†µí•´ ê³µì„ ì›€ì§ì´ê¸°
```cpp
void update(const float & dt)
{
    static const vec2 gravity = vec2(0.0f, -9.8f);

    // numerical integration ìˆ˜ì¹˜ ì ë¶„
    vel += gravity * dt;
    pos += vel * dt;

    // wall collision, friction
}
```
<br>
<img align="center" width="50%" height="50%" src="https://github.com/hayoonleeMe/hayoonleeMe.github.io/blob/main/assets/images/C%2B%2B%20Games%20images/1.png?raw=true">

ë‰´í„´ì˜ ì œ2 ë²•ì¹™ì—ì„œ f=ma ë³´ë‹¤ f/m=a, ì¦‰ í˜ì„ ì§ˆëŸ‰ìœ¼ë¡œ ë‚˜ëˆ„ë©´ ê°€ì†ë„ê°€ ë‚˜ì˜¨ë‹¤ëŠ” ê³„ì‚°ì„ ë” ë§ì´ í•œë‹¤.    
ê³µ íŠ•ê¸°ê¸° ì˜ˆì œì—ì„œëŠ” ì¤‘ë ¥ê°€ì†ë„ê°€ ì§ì ‘ ì£¼ì–´ì¡Œê¸° ë•Œë¬¸ì— ì‹ì„ í’€ ë•Œ f ê°€ ë“±ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤. ì´í›„ì˜ ê°•ì˜ì—ì„œëŠ” ê°€ì†ë„ê°€ í˜ìœ¼ë¡œë¶€í„° ìƒê²¨ë‚˜ëŠ” ì‹ë„ ë‹¤ë£° ì˜ˆì •ì´ë‹¤.
<br><br><br>
<img align="center" width="50%" height="50%" src="https://github.com/hayoonleeMe/hayoonleeMe.github.io/blob/main/assets/images/C%2B%2B%20Games%20images/2.png?raw=true">

ìš°ë¦¬ê°€ ë¯¸ë¶„ì„ ì´ìš©í•´ì„œ ì–´ë–¤ ê°œë…ì„ í‘œí˜„í•  ë•Œ dt ëŠ” float ë‚˜ double ì„ ì´ìš©í•´ì„œ í‘œí˜„í•˜ëŠ” ì‹œê°„ë³´ë‹¤ í›¨ì”¬ ì‘ì€ ì‹œê°„ì´ë‹¤.    
ê·¸ëŸ°ë° ì»´í“¨í„°ë¡œëŠ” ê·¸ë ‡ê²Œ ì‘ì€ ìˆ«ìë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ìœ í•œí•˜ê²Œ ì‘ì€ ìˆ«ìë¥¼ ì´ìš©í•´ì„œ ì°¨ì´ë¥¼ ì¸¡ì •í•œë‹¤.    
ìœ í•œí•œ ì†ë„ì— ëŒ€í•´ì„œ ìœ„ì¹˜ì˜ ì°¨ì´ë¥¼ ê³„ì‚°í•˜ê¸° ë•Œë¬¸ì— ìœ í•œ ì°¨ë¶„ë²•ì´ë¼ í•œë‹¤.

#### ê³µì´ ë²½ì„ ë§Œë‚˜ë©´ íŠ•ê²¨ì ¸ ë‚˜ì˜¤ë„ë¡ êµ¬í˜„
- Coliision detection , ìš°ì„  ê³µì´ ë²½ì— ë¶€ë”ªí˜”ëŠ”ì§€ ê²€ì‚¬í•´ì•¼ í•œë‹¤. 
- Coliision response ,  ë¶€ë”ªíŒ ë‹¤ìŒì— ë­˜ í•´ì•¼í• ì§€ë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.

<br><br>
<img align="center" width="50%" height="50%" src="https://github.com/hayoonleeMe/hayoonleeMe.github.io/blob/main/assets/images/C%2B%2B%20Games%20images/3.png?raw=true">

ê³µì˜ ì¤‘ì‹¬ê³¼ ë²½ì˜ ê±°ë¦¬ê°€ ë°˜ì§€ë¦„ë³´ë‹¤ ì‘ë‹¤ë©´ ë²½ì— ë‹¿ê±°ë‚˜ ëš«ê³  ë“¤ì–´ê°”ë‹¤ê³  íŒë‹¨í•œë‹¤.    
ë°˜ëŒ€ë¡œ ê³µì˜ ì¤‘ì‹¬ê³¼ ë²½ì˜ ê±°ë¦¬ê°€ ë°˜ì§€ë¦„ë³´ë‹¤ í¬ë‹¤ë©´ ë²½ì— ë‹¿ì§€ ì•Šì•˜ë‹¤ê³  íŒë‹¨í•œë‹¤.

```cpp
void update(const float & dt)
{
    static const vec2 gravity = vec2(0.0f, -9.8f);
    static const float coef_res = 0.3f;	

    // numerical integration ìˆ˜ì¹˜ ì ë¶„
    vel += gravity * dt;
    pos += vel * dt;

    // wall collision, friction
    if (1.0f - pos.x <= radius)	// right wall
    {
        pos.x = 1.0f - radius;

        if (vel.x >= 0.0f)	// ì•ˆì „ ì¥ì¹˜
            vel.x *= -1.0f * coef_res;
    }
}
```
ì˜¤ë¥¸ìª½ ë²½ì— ë¶€ë”ªíˆë©´ íŠ•ê²¨ì ¸ ë‚˜ì˜¤ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.    
ì™¼ìª½ ë²½ê³¼ ë°”ë‹¥ì„ êµ¬í˜„í•  ë•Œì—ë„ ë™ì¼í•˜ì§€ë§Œ í™”ë©´ ì¤‘ì•™ì˜ ì¢Œí‘œê°€ (0,0) ì´ë¼ëŠ” ê²ƒì— ìœ ì˜í•˜ì.    

<pre> info notice :

<b>Coefficient of restitution ë°˜ë°œ ê³„ìˆ˜</b> : 
ê³µì´ ë²½ì— ì¶©ëŒí•˜ë©´ ì§„í–‰ë°©í–¥ì´ ë°˜ëŒ€ë°©í–¥ìœ¼ë¡œ ë°”ë€Œê²Œ ë˜ëŠ”ë° ì´ë•Œ ê³µì˜ ì†ë„ëŠ” ê³µì˜ ë°˜ë°œ ê³„ìˆ˜ì— ë”°ë¼ ì •í•´ì§„ë‹¤.     

<b>-</b> 1.0 ì´ë©´ ì¶©ëŒ ì „ì˜ ì†ë„ì˜ ì ˆëŒ€ê°’ì„ ê·¸ëŒ€ë¡œ ê°€ì§€ê³  ë°©í–¥ë§Œ ë°”ê¿”ì„œ íŠ•ê²¨ì§„ë‹¤. (ì™„ì „íƒ„ì„±ì¶©ëŒ)    
<b>-</b> 1.0 ë³´ë‹¤ ë‚®ì„ìˆ˜ë¡ ê³µì˜ ì†ë„ê°€ ë²½ì— ë¨¹íˆê¸° ë•Œë¬¸ì— ì¶©ëŒ í›„ì˜ ì†ë„ëŠ” ì¤„ì–´ë“ ë‹¤.    
<b>-</b> 1.0 ë³´ë‹¤ ë†’ë‹¤ë©´ ë¬¼ë¦¬ì ì´ì§„ ì•Šì§€ë§Œ ì›í•˜ëŠ” ëŒ€ë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.</pre>{: .notice--warning}

```cpp
void update(const float & dt)
{
    static const vec2 gravity = vec2(0.0f, -9.8f);
    static const float coef_res = 0.3f;	

    // numerical integration ìˆ˜ì¹˜ ì ë¶„
    vel += gravity * dt;
    pos += vel * dt;

    // wall collision, friction
    if (1.0f - pos.x <= radius)	    // right wall
    {
        pos.x = 1.0f - radius;

        if (vel.x >= 0.0f)	// ì•ˆì „ ì¥ì¹˜
            vel.x *= -1.0f * coef_res;
    }

    if (pos.x <= -1.0f + radius)    // left wall
    {
        pos.x = -1.0f + radius;

        if (vel.x <= 0.0f)	
            vel.x *= -1.0f * coef_res;
    }

    if (pos.y <= -1.0f + radius)    // ground
    {
        pos.y = -1.0f + radius;

        if (vel.y <= 0.0f)	
            vel.y *= -1.0f * coef_res;
    }
}
```
ê³µì´ ë²½ê³¼ ë°”ë‹¥ì— ë¶€ë”ªíˆë©´ íŠ•ê²¨ì ¸ ë‚˜ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ ê³µì´ ë©ˆì¶”ì§€ ì•Šê³  ê³„ì† ì´ë™í•œë‹¤ëŠ” ë¬¸ì œê°€ ìˆë‹¤.    
ë°”ë‹¥ ë§ˆì°°ì„ êµ¬í˜„í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

#### ë§ˆì°°ë ¥ êµ¬í˜„í•˜ê¸°
ì—¬ê¸°ì„œ êµ¬í˜„í•˜ëŠ” ë§ˆì°° ê³„ìˆ˜ coef_friction ì€ ë¬¼ë¦¬ë²•ì¹™ì„ ë”°ë¥´ëŠ” ê²ƒì´ ì•„ë‹Œ ê°œë…ì´í•´ë¥¼ ìœ„í•´ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•œ ê²ƒì´ë‹¤.    
coefficient of friction : ë§ˆì°° ê³„ìˆ˜
```cpp
void update(const float & dt)
{
    static const vec2 gravity = vec2(0.0f, -9.8f);
    static const float coef_res = 0.3f;	
    static const float coef_friction = 0.99f;	// friction (not physical, just simple ex)	

    // numerical integration ìˆ˜ì¹˜ ì ë¶„
    vel += gravity * dt;
    pos += vel * dt;

    // wall collision, friction
    if (1.0f - pos.x <= radius)	    // right wall
    {
        pos.x = 1.0f - radius;

        if (vel.x >= 0.0f)	// ì•ˆì „ ì¥ì¹˜
            vel.x *= -1.0f * coef_res;
    }

    if (pos.x <= -1.0f + radius)    // left wall
    {
        pos.x = -1.0f + radius;

        if (vel.x <= 0.0f)	
            vel.x *= -1.0f * coef_res;
    }

    if (pos.y <= -1.0f + radius)    // ground
    {
        pos.y = -1.0f + radius;

        if (vel.y <= 0.0f)	
            vel.y *= -1.0f * coef_res;

        vel.x *= coef_friction;
    }
}
```
ë°”ë‹¥ì—ì„œ ë§ˆì°°ë ¥ì€ ê³µì´ ì¢Œìš°ë¡œ ì›€ì§ì¼ ë•Œ ì ìš©ë˜ë¯€ë¡œ ì†ë„ì˜ x ê°’ì— coef_friction ì„ ê³±í•´ì£¼ëŠ” ê²ƒìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

<pre>ë³¸ ë¸”ë¡œê·¸ëŠ” ê°œì¸ ê³µë¶€ ê¸°ë¡ì˜ ëª©ì ì„ ê°€ì§‘ë‹ˆë‹¤. í¬ìŠ¤íŠ¸ì˜ ë‚´ìš©ì€ ì–¸ì œë“ ì§€ ë°”ë€” ìˆ˜ ìˆìŠµë‹ˆë‹¤.</pre>{: .notice--info}